@page "/"

<PageTitle>Index</PageTitle>

<AddMachine Add="AddMachine"></AddMachine>

<Machines MachinePark=@machines UpdateTemperture="UpdateTemp"></Machines>

@code {
    private List<Machine> machines = new List<Machine>();

    protected override async Task OnInitializedAsync()
    {
        machines = await httpClient.GetFromJsonAsync<List<Machine>>("api/machines");
    }

    public async Task AddMachine(string name)
    {
        if (string.IsNullOrEmpty(name)) return;

        var response = await httpClient.PostAsJsonAsync<CreateMachineDto>("/api/machines", new CreateMachineDto { Name = name });

        if (response.IsSuccessStatusCode)
        {
            var machine = await response.Content.ReadFromJsonAsync<Machine>();
            if (machine != null)
                machines.Add(machine);
        }
    }

    public async Task UpdateTemp(Machine machine)
    {
       
        var response = await httpClient.PutAsJsonAsync<Machine>($"api/machines/{machine.Id}", machine);
    }
}